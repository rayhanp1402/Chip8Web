const fontsetSize = 80;

class CHIP8 {
    // 16 8-bit Registers (V0 to VF)
    V = new Uint8Array(16);
    
    // Program Counter
    PC = new Uint16Array(1);
    
    // Index Register
    I = new Uint16Array(1);

    // 16-level Stack
    stack = new Uint16Array(16);
    
    // Stack Pointer
    SP = new Uint8Array(1);
    
    // 4K bytes of memory
    memory = new Uint8Array(4096);
    
    // Delay Timer
    delay = new Uint8Array(1);
    
    // Sound Timer
    sound = new Uint8Array(1);

    // Keypads, using KeyboardEvent codes
    keyMap = {
        "Digit1": 0x1, "Digit2": 0x2, "Digit3": 0x3, "Digit4": 0xC,
        "KeyQ": 0x4, "KeyW": 0x5, "KeyE": 0x6, "KeyR": 0xD,
        "KeyA": 0x7, "KeyS": 0x8, "KeyD": 0x9, "KeyF": 0xE,
        "KeyZ": 0xA, "KeyX": 0x0, "KeyC": 0xB, "KeyV": 0xF
    };

    // Fonts
    fontset = [
        0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
        0x20, 0x60, 0x20, 0x20, 0x70, // 1
        0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
        0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
        0x90, 0x90, 0xF0, 0x10, 0x10, // 4
        0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
        0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
        0xF0, 0x10, 0x20, 0x40, 0x40, // 7
        0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
        0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
        0xF0, 0x90, 0xF0, 0x90, 0x90, // A
        0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
        0xF0, 0x80, 0x80, 0x80, 0xF0, // C
        0xE0, 0x90, 0x90, 0x90, 0xE0, // D
        0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
        0xF0, 0x80, 0xF0, 0x80, 0x80  // F
    ];

    constructor() {
        const fontsetStartAddress = 0x50;

        // Loads the fonts into memory
        for (let i = 0; i < fontsetSize; ++i) {
            this.memory[fontsetStartAddress + i] = this.fontset[i];
        }
    };
}
